"use strict";

export default class SendRequest {
  constructor(request, timeout) {
    this.request = request;
    this.timeout = timeout;
  }

  _finish(result, callback) {
    this._httpTimeID && clearTimeout(this._httpTimeID);
    callback(result);
  }

  sendRequest() {
    return new Promise((resolve, reject) => {
      if (typeof this.timeout == "number") {
        this._httpTimeID = setTimeout(
          () =>
            this._finish({ code: 503, message: "请求超时", timeout: true }, reject),
          this.timeout
        );
      }
      return fetch(this.request).then(
        response => {
          this._finish(response, resolve);
        },
        response => {
          this._finish(response, reject);
        }
      );
    });
  }
}
